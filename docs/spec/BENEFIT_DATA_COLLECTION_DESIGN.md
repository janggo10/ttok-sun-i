# ë³µì§€/í˜œíƒ ë°ì´í„° ìˆ˜ì§‘ íŒŒì´í”„ë¼ì¸ ì„¤ê³„ (1.1 ë³´ì¡°ê¸ˆ24 API ì—°ë™)

## ğŸ“‹ ê°œìš”

**ëª©ì **: ë³µì§€/í˜œíƒ/ë³´ì¡°ê¸ˆ ë°ì´í„°ë¥¼ ê³µê³µ APIì—ì„œ ìˆ˜ì§‘í•˜ì—¬ Supabase `benefits` í…Œì´ë¸”ì— ì €ì¥

**ìš°ì„ ìˆœìœ„**: ğŸ”¥ HIGH PRIORITY (MVP í•µì‹¬ ê¸°ëŠ¥)

**ê´€ë ¨ TODO**: `docs/TODO.md` - 1.1 ë³´ì¡°ê¸ˆ24 API ì—°ë™

---

## 1. ë³µì§€/í˜œíƒ/ë³´ì¡°ê¸ˆ API ì œê³µì²˜

### 1.1 ì£¼ìš” ì œê³µì²˜ ì¡°ì‚¬ ê²°ê³¼

| ì œê³µì²˜ | APIëª… | ì œê³µ ë°ì´í„° | ì ‘ê·¼ì„± | ìš°ì„ ìˆœìœ„ |
|--------|-------|-------------|--------|----------|
| **ë³µì§€ë¡œ (bokjiro.go.kr)** | ì„œë¹„ìŠ¤ ìƒì„¸ì¡°íšŒ API | ë³µì§€ ì„œë¹„ìŠ¤ ìƒì„¸ì •ë³´ (ëŒ€ìƒ, ë‚´ìš©, ì‹ ì²­ë°©ë²•, ì§€ì—­ ë“±) | ê³µê³µë°ì´í„°í¬í„¸ ì¸ì¦í‚¤ | â­â­â­ 1ìˆœìœ„ |
| ê³µê³µë°ì´í„°í¬í„¸ | êµ­ê³ ë³´ì¡°ê¸ˆ ì •ë³´ API | êµ­ê³ ë³´ì¡°ê¸ˆ ì˜ˆì‚° ë° ì§‘í–‰ í˜„í™© | ê³µê³µë°ì´í„°í¬í„¸ ì¸ì¦í‚¤ | â­â­ 2ìˆœìœ„ |
| ì„œìš¸ì‹œ ì—´ë¦°ë°ì´í„°ê´‘ì¥ | ë³µì§€ì‹œì„¤/ì„œë¹„ìŠ¤ API | ì„œìš¸ì‹œ ìì²´ ë³µì§€ ì„œë¹„ìŠ¤ | ì„œìš¸ ì—´ë¦°ë°ì´í„° API í‚¤ | â­â­ ì¶”ê°€ |
| ê²½ê¸°ë„ ê³µê³µë°ì´í„° | ë³µì§€/ë³´ì¡°ê¸ˆ ì •ë³´ | ê²½ê¸°ë„ ìì²´ ë³µì§€ ì„œë¹„ìŠ¤ | ê²½ê¸°ë°ì´í„°ë“œë¦¼ API í‚¤ | â­â­ ì¶”ê°€ |
| í–‰ì •ì•ˆì „ë¶€ | ë³´ì¡°ê¸ˆ24 í†µê³„ì—°ë³´ | ì´ìš© í†µê³„ (ê±´ìˆ˜, ë¹„ìœ¨ ë“±) | ê³µê³µë°ì´í„°í¬í„¸ ì¸ì¦í‚¤ | â­ í†µê³„ìš© |

**âœ… MVP ë‹¨ê³„**: ë³µì§€ë¡œ API 1ê°œë§Œ ìš°ì„  êµ¬í˜„  
**âœ… í™•ì¥ ë‹¨ê³„**: ê³µê³µë°ì´í„°í¬í„¸ + ì£¼ìš” ì§€ìì²´ API ì¶”ê°€ (ì„œìš¸, ê²½ê¸°, ë¶€ì‚° ë“±)

### 1.2 ìµœì¢… ì„ íƒ: ë³µì§€ë¡œ API âœ…

#### ì˜µì…˜ A: ì¤‘ì•™ë¶€ì²˜ë³µì§€ì„œë¹„ìŠ¤ API âš ï¸ (ì—°ë™ ë³´ë¥˜)
- **APIëª…**: í•œêµ­ì‚¬íšŒë³´ì¥ì •ë³´ì›_ì¤‘ì•™ë¶€ì²˜ë³µì§€ì„œë¹„ìŠ¤
- **ìƒíƒœ**: ê·œê²© ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ ë¶ˆê°€ (ë³µêµ¬ì¤‘)
- **ë¬¸ì œ**: INVALID_REQUEST_PARAMETER_ERROR
- **TODO**: ê·œê²© ë¬¸ì„œ í™•ë³´ í›„ ì¬ì‹œë„

#### ì˜µì…˜ B: ì§€ìì²´ë³µì§€ì„œë¹„ìŠ¤ API â­ (í˜„ì¬ ì‘ì—…)
- **APIëª…**: í•œêµ­ì‚¬íšŒë³´ì¥ì •ë³´ì›_ì§€ìì²´ë³µì§€ì„œë¹„ìŠ¤
- **ì„ íƒ ì´ìœ **:
  - âœ… ì§€ìì²´ë³„ ë³µì§€ ì„œë¹„ìŠ¤ ìƒì„¸ì •ë³´ ì œê³µ
  - âœ… ì„œìš¸/ê²½ê¸° ë“± ì§€ì—­ë³„ í•„í„°ë§ ê°€ëŠ¥
  - âœ… ê³µê³µë°ì´í„°í¬í„¸ í†µí•© ì¸ì¦í‚¤ ì‚¬ìš©
- **ê³µê³µë°ì´í„°í¬í„¸**: https://www.data.go.kr/data/15083323/fileData.do

---

## 2. ë°ì´í„° ìˆ˜ì§‘ ë²”ìœ„ ë° ì¦ë¶„ ìˆ˜ì§‘ ì „ëµ

### 2.1 ì´ˆê¸° ë°ì´í„° ìˆ˜ì§‘ ë²”ìœ„

**ì§ˆë¬¸**: ì²˜ìŒ DBê°€ ë¹„ì–´ìˆì„ ë•Œ ëª‡ ë…„ ì „ ë°ì´í„°ê¹Œì§€ ì €ì¥í•  ê²ƒì¸ê°€?

**ë‹µë³€**: **ìµœê·¼ 1~2ë…„ + í˜„ì¬ ìœ íš¨í•œ ë³µì§€ ì„œë¹„ìŠ¤ë§Œ** ìˆ˜ì§‘ âœ…

#### ê·¼ê±°:
- âŒ **10ë…„ ì „ ë°ì´í„°ëŠ” ë¶ˆí•„ìš”**
  - ì œë„ê°€ ë³€ê²½ë˜ì—ˆê±°ë‚˜ ì¢…ë£Œëœ ì„œë¹„ìŠ¤ê°€ ëŒ€ë¶€ë¶„
  - ì‚¬ìš©ìì—ê²Œ í˜¼ë€ë§Œ ì¤Œ
  - DB ìš©ëŸ‰ ë‚­ë¹„

- âœ… **1~2ë…„ ì „ ë°ì´í„°ëŠ” ìœ ìš©**
  - í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì¥ê¸° ë³µì§€ ì„œë¹„ìŠ¤ (ì˜ˆ: ê¸°ì´ˆì—°ê¸ˆ)
  - ì‘ë…„ì— ì‹œì‘ë˜ì–´ ì˜¬í•´ë„ ê³„ì†ë˜ëŠ” ì„œë¹„ìŠ¤
  - ì—°ë„ë³„ ë¹„êµ ë° ë¶„ì„ ê°€ëŠ¥

- âœ… **í˜„ì¬ ìœ íš¨í•œ ë°ì´í„°ë§Œ ìš°ì„ **
  - `application_end_date`ê°€ `NULL` (ìƒì‹œ ìš´ì˜)
  - ë˜ëŠ” `application_end_date >= í˜„ì¬ ë‚ ì§œ` (ë§ˆê° ì „)
  - `status = 'active'`

#### êµ¬í˜„ ë°©ë²•:

**ì˜µì…˜ 1: API ë‚ ì§œ í•„í„° ì‚¬ìš©** (APIê°€ ì§€ì›í•˜ëŠ” ê²½ìš°)
```python
# ì´ˆê¸° ìˆ˜ì§‘ ì‹œ
start_date = (datetime.now() - timedelta(days=365*2)).strftime('%Y%m%d')  # 2ë…„ ì „
params = {
    'serviceKey': API_KEY,
    'pageNo': 1,
    'numOfRows': 100,
    'fromDate': start_date,  # 2ë…„ ì „ë¶€í„°
    'toDate': datetime.now().strftime('%Y%m%d')  # ì˜¤ëŠ˜ê¹Œì§€
}
```

**ì˜µì…˜ 2: ì „ì²´ ì¡°íšŒ í›„ í•„í„°ë§** (APIê°€ ë‚ ì§œ í•„í„° ë¯¸ì§€ì› ì‹œ)
```python
# ì „ì²´ ë°ì´í„° ì¡°íšŒ í›„
for item in api_response:
    register_date = item.get('svcfrstRgstDt')  # ì„œë¹„ìŠ¤ ìµœì´ˆ ë“±ë¡ì¼
    last_mod_date = item.get('lastModYmd')      # ìµœì¢… ìˆ˜ì •ì¼
    
    # 2ë…„ ì´ë‚´ ë“±ë¡ ë˜ëŠ” ìµœê·¼ ìˆ˜ì •ëœ ê²ƒë§Œ
    if is_within_2_years(register_date) or is_within_2_years(last_mod_date):
        save_to_db(item)
```

### 2.2 ì¦ë¶„ ìˆ˜ì§‘ ì „ëµ (Incremental Collection)

**ì§ˆë¬¸**: ì´ˆê¸° ì €ì¥ ì´í›„ ë§¤ì¼ ìˆ˜ì§‘í•  ë•Œ, ìƒˆë¡œìš´ ë°ì´í„°ë§Œ ì–´ë–»ê²Œ ê°€ì ¸ì˜¬ ê²ƒì¸ê°€?

**ë‹µë³€**: **3ë‹¨ê³„ ì¦ë¶„ ìˆ˜ì§‘ ì „ëµ** âœ…

#### ì „ëµ 1: ë§ˆì§€ë§‰ ìˆ˜ì§‘ ì‹œê° ê¸°ë°˜ í•„í„°ë§ (Best)

```python
# api_sync_logs í…Œì´ë¸”ì—ì„œ ë§ˆì§€ë§‰ ì„±ê³µ ì‹œê° ì¡°íšŒ
last_sync = get_last_successful_sync('bokjiro')
# ì˜ˆ: 2026-01-20 11:00:00

# API í˜¸ì¶œ ì‹œ ë‚ ì§œ í•„í„° ì‚¬ìš©
params = {
    'fromDate': last_sync.strftime('%Y%m%d'),  # ë§ˆì§€ë§‰ ìˆ˜ì§‘ì¼ë¶€í„°
    'toDate': datetime.now().strftime('%Y%m%d')  # ì˜¤ëŠ˜ê¹Œì§€
}
```

**ì¥ì **:
- âœ… API í˜¸ì¶œ íšŸìˆ˜ ìµœì†Œí™” (ë³€ê²½ëœ ê²ƒë§Œ ì¡°íšŒ)
- âœ… ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ì ˆì•½
- âœ… ë¹ ë¥¸ ì‹¤í–‰ ì‹œê°„

**ë‹¨ì **:
- âŒ APIê°€ `fromDate` íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì›í•´ì•¼ í•¨

#### ì „ëµ 2: ì „ì²´ ì¡°íšŒ + DB ì¤‘ë³µ ì²´í¬ (Fallback)

```python
# ì „ì²´ ë°ì´í„° ì¡°íšŒ
all_items = fetch_all_benefits_from_api()

for item in all_items:
    # 1ë‹¨ê³„: DBì— ì´ë¯¸ ìˆëŠ”ì§€ ì²´í¬
    existing = check_duplicate(item)
    
    if existing:
        # 2ë‹¨ê³„: ë‚´ìš©ì´ ë³€ê²½ë˜ì—ˆëŠ”ì§€ ì²´í¬
        if content_changed(existing, item):
            update_benefit(existing.id, item)  # UPDATE
        else:
            continue  # SKIP (ì™„ì „ ì¤‘ë³µ)
    else:
        insert_benefit(item)  # INSERT (ì‹ ê·œ)
```

**ì¥ì **:
- âœ… APIê°€ ë‚ ì§œ í•„í„°ë¥¼ ì§€ì›í•˜ì§€ ì•Šì•„ë„ ì‘ë™
- âœ… ëˆ„ë½ëœ ë°ì´í„° ì¬ìˆ˜ì§‘ ê°€ëŠ¥

**ë‹¨ì **:
- âŒ ë§¤ë²ˆ ì „ì²´ ë°ì´í„° ì¡°íšŒ (API í˜¸ì¶œ ë§ìŒ)
- âŒ ì‹¤í–‰ ì‹œê°„ ì˜¤ë˜ ê±¸ë¦¼

#### ì „ëµ 3: í•˜ì´ë¸Œë¦¬ë“œ (ì¶”ì²œ) â­

```python
# 1ì£¼ì¼ ì „ë¶€í„° ë°ì´í„° ì¡°íšŒ (ì•ˆì „ ë§ˆì§„)
start_date = (datetime.now() - timedelta(days=7)).strftime('%Y%m%d')

params = {
    'fromDate': start_date,  # 1ì£¼ì¼ ì „ë¶€í„°
    'toDate': datetime.now().strftime('%Y%m%d')
}

recent_items = fetch_benefits_from_api(params)

for item in recent_items:
    # ì¤‘ë³µ ì²´í¬ ë° UPSERT
    upsert_benefit(item)
```

**ì¥ì **:
- âœ… ì•ˆì „ ë§ˆì§„ìœ¼ë¡œ ëˆ„ë½ ë°©ì§€
- âœ… API í˜¸ì¶œ ìµœì†Œí™”
- âœ… ì¤‘ë³µ ì²´í¬ë¡œ ë¬´ê²°ì„± ë³´ì¥

### 2.3 ì¦ë¶„ ìˆ˜ì§‘ ë¡œì§ í”Œë¡œìš°ì°¨íŠ¸

```
ë§¤ì¼ ì˜¤ì „ 11ì‹œ ì‹¤í–‰
     â†“
api_sync_logsì—ì„œ ë§ˆì§€ë§‰ ì„±ê³µ ì‹œê° ì¡°íšŒ
     â†“
ë§ˆì§€ë§‰ ìˆ˜ì§‘ì¼ - 7ì¼ ~ ì˜¤ëŠ˜ (ì•ˆì „ ë§ˆì§„)
     â†“
API í˜¸ì¶œ (fromDate, toDate íŒŒë¼ë¯¸í„°)
     â†“
ê° itemì— ëŒ€í•´:
  â”œâ”€ DBì— ì´ë¯¸ ì¡´ì¬? (source + title + url ì²´í¬)
  â”‚   â”œâ”€ YES â†’ content_hash ë¹„êµ
  â”‚   â”‚         â”œâ”€ ë™ì¼ â†’ SKIP
  â”‚   â”‚         â””â”€ ë³€ê²½ â†’ UPDATE
  â”‚   â””â”€ NO â†’ INSERT
  â†“
api_sync_logsì— ì‹¤í–‰ ê²°ê³¼ ê¸°ë¡
  - rows_affected: 5 (ì‹ ê·œ ì‚½ì…)
  - duplicates_skipped: 120 (ì¤‘ë³µ)
  - status: SUCCESS
  â†“
Slack ì•Œë¦¼: "âœ… ë³µì§€ë¡œ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ (ì‹ ê·œ 5ê±´, ì¤‘ë³µ 120ê±´)"
```

### 2.4 êµ¬í˜„ ì˜ˆì‹œ ì½”ë“œ ìŠ¤ì¼€ì¹˜

```python
def collect_benefits_incremental():
    """ì¦ë¶„ ìˆ˜ì§‘: ë§ˆì§€ë§‰ ìˆ˜ì§‘ ì´í›„ ë³€ê²½ëœ ë°ì´í„°ë§Œ"""
    
    # 1. ë§ˆì§€ë§‰ ìˆ˜ì§‘ ì‹œê° ì¡°íšŒ
    last_sync = get_last_sync_time('bokjiro')
    
    # 2. ì•ˆì „ ë§ˆì§„ (7ì¼ ì „ë¶€í„°)
    start_date = (last_sync - timedelta(days=7)).strftime('%Y%m%d')
    end_date = datetime.now().strftime('%Y%m%d')
    
    # 3. API í˜¸ì¶œ
    items = fetch_bokjiro_api(fromDate=start_date, toDate=end_date)
    
    # 4. UPSERT
    new_count = 0
    updated_count = 0
    skipped_count = 0
    
    for item in items:
        result = upsert_benefit(item)
        
        if result == 'INSERT':
            new_count += 1
        elif result == 'UPDATE':
            updated_count += 1
        else:
            skipped_count += 1
    
    # 5. ë¡œê¹…
    log_sync_result('bokjiro', new_count, updated_count, skipped_count)
    
    # 6. Slack ì•Œë¦¼
    notify_slack(f"âœ… ë³µì§€ë¡œ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ\nì‹ ê·œ: {new_count}, ì—…ë°ì´íŠ¸: {updated_count}, ì¤‘ë³µ: {skipped_count}")
```

---

## 3. ë³µì§€ë¡œ API ìƒì„¸ ìŠ¤í™

### 2.1 ê¸°ë³¸ ì •ë³´

```
ê¸°ê´€ëª…: ë³´ê±´ë³µì§€ë¶€ ì‚¬íšŒë³´ì¥ì •ë³´ì›
APIëª…: ë³µì§€ì„œë¹„ìŠ¤ ìƒì„¸ì¡°íšŒ API
ì—”ë“œí¬ì¸íŠ¸: http://apis.data.go.kr/B554287/ë³µì§€ì„œë¹„ìŠ¤ (ì‹¤ì œ ì—”ë“œí¬ì¸íŠ¸ëŠ” API ë¬¸ì„œ í™•ì¸ í•„ìš”)
ì¸ì¦ë°©ì‹: ServiceKey (ê³µê³µë°ì´í„°í¬í„¸ ë°œê¸‰)
ë°ì´í„° í˜•ì‹: XML / JSON
íŠ¸ë˜í”½ ì œí•œ: 1,000~10,000íšŒ/ì¼ (ê³„ì • ë“±ê¸‰ì— ë”°ë¼)
```

### 3.2 ì˜ˆìƒ ìš”ì²­ íŒŒë¼ë¯¸í„°

| íŒŒë¼ë¯¸í„° | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|----------|------|------|------|------|
| serviceKey | String | í•„ìˆ˜ | ê³µê³µë°ì´í„°í¬í„¸ ì¸ì¦í‚¤ | (ë°œê¸‰ë°›ì€ í‚¤) |
| pageNo | Integer | í•„ìˆ˜ | í˜ì´ì§€ ë²ˆí˜¸ | 1 |
| numOfRows | Integer | í•„ìˆ˜ | í•œ í˜ì´ì§€ ê²°ê³¼ ìˆ˜ | 100 |
| servId | String | ì˜µì…˜ | ì„œë¹„ìŠ¤ ID | - |
| servNm | String | ì˜µì…˜ | ì„œë¹„ìŠ¤ëª… ê²€ìƒ‰ | ë…¸ì¸ |
| servDgst | String | ì˜µì…˜ | ì„œë¹„ìŠ¤ ìš”ì•½ ê²€ìƒ‰ | - |
| lifeArray | String | ì˜µì…˜ | ìƒì• ì£¼ê¸° êµ¬ë¶„ | 004 (ë…¸ë…„) |
| trgterIndvdlArray | String | ì˜µì…˜ | ëŒ€ìƒ ê°œì¸ íŠ¹ì„± | - |
| servDtlTpCd | String | ì˜µì…˜ | ì„œë¹„ìŠ¤ ìƒì„¸ ìœ í˜• | - |

### 3.3 ì˜ˆìƒ ì‘ë‹µ êµ¬ì¡° (JSON)

```json
{
  "response": {
    "header": {
      "resultCode": "00",
      "resultMsg": "NORMAL SERVICE"
    },
    "body": {
      "totalCount": 1234,
      "pageNo": 1,
      "numOfRows": 100,
      "items": [
        {
          "servId": "WII00000001",
          "servNm": "ê¸°ì´ˆì—°ê¸ˆ",
          "servDgst": "ë§Œ 65ì„¸ ì´ìƒ ì–´ë¥´ì‹  ì¤‘ ì†Œë“ì¸ì •ì•¡ì´ ì„ ì •ê¸°ì¤€ì•¡ ì´í•˜ì¸ ë¶„ê»˜ ë§¤ì›” ì¼ì •ì•¡ ì§€ê¸‰",
          "servDtlLink": "https://...",
          "inqNum": 12345,
          "lifeNmArray": "ë…¸ë…„",
          "trgterIndvdlArray": "ë…¸ì¸",
          "sprtCycArray": "ì›”",
          "servCn": "...(ìƒì„¸ ë‚´ìš©)...",
          "svcfrstRgstDt": "20140101",
          "lastModYmd": "20231215",
          "intrsThemaNm": "ìƒí™œì§€ì›",
          "slctCritCn": "ë§Œ 65ì„¸ ì´ìƒ, ì†Œë“ì¸ì •ì•¡ í•˜ìœ„ 70%",
          "aplyMtdCn": "ì£¼ë¯¼ì„¼í„° ë°©ë¬¸ ë˜ëŠ” ì˜¨ë¼ì¸ ì‹ ì²­",
          "servRgnAra": "ì „êµ­",
          "servRgnAreaCd": "ALL"
        }
      ]
    }
  }
}
```

**ì£¼ìš” í•„ë“œ**:
- `servId`: ì„œë¹„ìŠ¤ ê³ ìœ  ID (ì¤‘ë³µ ì œê±° ê¸°ì¤€)
- `servNm`: ì„œë¹„ìŠ¤ëª… (title)
- `servDgst`: ì„œë¹„ìŠ¤ ìš”ì•½ (ì§§ì€ ì„¤ëª…)
- `servCn`: ì„œë¹„ìŠ¤ ìƒì„¸ ë‚´ìš© (content)
- `servDtlLink`: ìƒì„¸ ë§í¬ (original_url)
- `lifeNmArray`: ìƒì• ì£¼ê¸° (ë…¸ë…„ ë“±)
- `trgterIndvdlArray`: ëŒ€ìƒ ê°œì¸ íŠ¹ì„± (ë…¸ì¸, ì¥ì• ì¸ ë“±)
- `intrsThemaNm`: ê´€ì‹¬ í…Œë§ˆ (category ë§¤í•‘)
- `slctCritCn`: ì„ ì • ê¸°ì¤€ (target íŒŒì‹±)
- `aplyMtdCn`: ì‹ ì²­ ë°©ë²•
- `servRgnAra`: ì„œë¹„ìŠ¤ ì§€ì—­ (ì§€ì—­ëª…)
- `servRgnAreaCd`: ì„œë¹„ìŠ¤ ì§€ì—­ ì½”ë“œ

---

## 4. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (ê¸°ì¡´ ì„¤ê³„ í™•ì¸)

### 4.1 `benefits` í…Œì´ë¸” êµ¬ì¡°

```sql
create table benefits (
  id bigint primary key generated always as identity,
  title text not null,                        -- servNm
  category_codes text[],                      -- intrsThemaNm ë§¤í•‘
  
  target_age_min int,                         -- slctCritCn íŒŒì‹±
  target_age_max int,                         -- slctCritCn íŒŒì‹±
  target_gender text,                         -- slctCritCn íŒŒì‹±
  region_codes text[],                        -- servRgnAreaCd ë§¤í•‘
  
  content text,                               -- servDgst + servCn ì¡°í•©
  original_url text,                          -- servDtlLink
  
  application_start_date date,                -- (APIì—ì„œ ì œê³µ ì‹œ)
  application_end_date date,                  -- (APIì—ì„œ ì œê³µ ì‹œ)
  
  source_name text,                           -- 'bokjiro'
  is_active boolean default true,
  content_hash text,                          -- ì¤‘ë³µ ì œê±°ìš©
  
  created_at timestamp with time zone default now(),
  updated_at timestamp with time zone default now()
);
```

### 4.2 í•„ë“œ ë§¤í•‘ ì „ëµ

| benefits í•„ë“œ | ë³µì§€ë¡œ API í•„ë“œ | íŒŒì‹±/ë³€í™˜ ë¡œì§ |
|--------------|-----------------|---------------|
| title | servNm | ì§ì ‘ ë§¤í•‘ |
| category_codes | intrsThemaNm | ì¹´í…Œê³ ë¦¬ ë§¤í•‘ í…Œì´ë¸” ì‚¬ìš© |
| target_age_min/max | slctCritCn | ì •ê·œì‹ + LLM íŒŒì‹± ("ë§Œ 65ì„¸ ì´ìƒ" â†’ age_min=65) |
| target_gender | slctCritCn | ì •ê·œì‹ íŒŒì‹± ("ì—¬ì„±", "ë‚¨ì„±", "ëª¨ë‘") |
| region_codes | servRgnAreaCd | "ALL" â†’ ['ALL'], ì§€ì—­ì½”ë“œ â†’ regions í…Œì´ë¸” ë§¤í•‘ |
| content | servDgst + servCn | ìš”ì•½ + ìƒì„¸ ë‚´ìš© ì¡°í•© |
| original_url | servDtlLink | ì§ì ‘ ë§¤í•‘ |
| source_name | - | 'bokjiro' ê³ ì •ê°’ |
| content_hash | - | generate_content_hash(title, content) í•¨ìˆ˜ ì‚¬ìš© |

---

## 5. ì¤‘ë³µ ì œê±° ë¡œì§ ì„¤ê³„

### 5.1 ì¤‘ë³µ ì œê±° ì „ëµ (2ë‹¨ê³„)

**1ë‹¨ê³„: ê³ ìœ  ID ê¸°ë°˜ ì²´í¬** (ë¹ ë¦„)
```sql
SELECT id FROM benefits 
WHERE source_name = 'bokjiro' 
  AND title = :servNm 
  AND original_url = :servDtlLink
LIMIT 1;
```

**2ë‹¨ê³„: Content Hash ê¸°ë°˜ ì²´í¬** (ìœ ì‚¬ ì¤‘ë³µ ê°ì§€)
```sql
SELECT id FROM benefits 
WHERE content_hash = generate_content_hash(:title, :content)
LIMIT 1;
```

### 5.2 ì¤‘ë³µ ì²˜ë¦¬ ì •ì±…

| ì¼€ì´ìŠ¤ | íŒë‹¨ ê¸°ì¤€ | ì²˜ë¦¬ ë°©ë²• |
|--------|----------|----------|
| ì™„ì „ ì¤‘ë³µ | servId ë˜ëŠ” (source_name + title + url) ì¼ì¹˜ | **SKIP** (ë¡œê·¸ë§Œ ê¸°ë¡) |
| ë‚´ìš© ë³€ê²½ | 1ë‹¨ê³„ ì¼ì¹˜ + content_hash ë¶ˆì¼ì¹˜ | **UPDATE** (content, updated_at ê°±ì‹ ) |
| ì‹ ê·œ ë°ì´í„° | 1, 2ë‹¨ê³„ ëª¨ë‘ ë¶ˆì¼ì¹˜ | **INSERT** (ìƒˆë¡œìš´ ë ˆì½”ë“œ ìƒì„±) |
| ì†ŒìŠ¤ì—ì„œ ì‚­ì œ | DBì—ëŠ” ìˆìœ¼ë‚˜ API ì‘ë‹µì— ì—†ìŒ | **DEACTIVATE** (is_active = false) |

### 5.3 ì¤‘ë³µ ì œê±° í”Œë¡œìš°ì°¨íŠ¸

```
API ë°ì´í„° ìˆ˜ì§‘
     â†“
1ë‹¨ê³„: servId ë˜ëŠ” (source + title + url) ì²´í¬
     â†“
  ì¼ì¹˜?
  â”œâ”€ YES â†’ 2ë‹¨ê³„: content_hash ì²´í¬
  â”‚          â†“
  â”‚       ì¼ì¹˜?
  â”‚       â”œâ”€ YES â†’ SKIP (ì¤‘ë³µ)
  â”‚       â””â”€ NO â†’ UPDATE (ë‚´ìš© ë³€ê²½)
  â”‚
  â””â”€ NO â†’ INSERT (ì‹ ê·œ)
```

---

## 6. ë°ì´í„° ìˆ˜ì§‘ íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜

### 6.1 ì „ì²´ íë¦„ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. API í˜¸ì¶œ (Pagination)                                   â”‚
â”‚     - pageNo = 1ë¶€í„° totalCountê¹Œì§€ ë°˜ë³µ                    â”‚
â”‚     - numOfRows = 100 (í•œ ë²ˆì— 100ê°œì”©)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ë°ì´í„° íŒŒì‹± & ì •ì œ                                      â”‚
â”‚     - JSON â†’ Python Dict                                    â”‚
â”‚     - í•„ìˆ˜ í•„ë“œ ê²€ì¦ (title, content ë“±)                    â”‚
â”‚     - null/ë¹ˆ ê°’ ì²˜ë¦¬                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. í•„ë“œ ë³€í™˜ & ë§¤í•‘                                        â”‚
â”‚     - category_codes: ì¹´í…Œê³ ë¦¬ ë§¤í•‘ í…Œì´ë¸” ì¡°íšŒ              â”‚
â”‚     - region_codes: ì§€ì—­ì½”ë“œ ë³€í™˜                           â”‚
â”‚     - target_age: ì •ê·œì‹ íŒŒì‹± ("ë§Œ 65ì„¸ ì´ìƒ" â†’ 65)        â”‚
â”‚     - content_hash: MD5 í•´ì‹œ ìƒì„±                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ì¤‘ë³µ ì²´í¬ (2ë‹¨ê³„)                                       â”‚
â”‚     - 1ë‹¨ê³„: source + title + url                           â”‚
â”‚     - 2ë‹¨ê³„: content_hash                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â†“                   â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  5a. INSERT  â”‚   â”‚  5b. UPDATE  â”‚
   â”‚   (ì‹ ê·œ)     â”‚   â”‚  (ë³€ê²½ë¨)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ë¡œê¹… & ì•Œë¦¼                                             â”‚
â”‚     - api_sync_logs í…Œì´ë¸”ì— ì‹¤í–‰ ì´ë ¥ ì €ì¥                  â”‚
â”‚     - Slack ì•Œë¦¼ (ì„±ê³µ/ì‹¤íŒ¨, ìˆ˜ì§‘ ê±´ìˆ˜, ì¤‘ë³µ ê±´ìˆ˜)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ

| ì—ëŸ¬ ìœ í˜• | ì²˜ë¦¬ ë°©ë²• | ì¬ì‹œë„ |
|----------|----------|--------|
| API í˜¸ì¶œ ì‹¤íŒ¨ (Network) | ë¡œê·¸ ê¸°ë¡ + Slack ì•Œë¦¼ | 3íšŒ ì¬ì‹œë„ (exponential backoff) |
| API ì‘ë‹µ ì—ëŸ¬ (500, 400) | ë¡œê·¸ ê¸°ë¡ + Slack ì•Œë¦¼ | ì¬ì‹œë„ ì—†ìŒ (ìš´ì˜ì í™•ì¸ í•„ìš”) |
| í•„ìˆ˜ í•„ë“œ ëˆ„ë½ | SKIP + ë¡œê·¸ ê¸°ë¡ | ì¬ì‹œë„ ì—†ìŒ |
| DB ì €ì¥ ì‹¤íŒ¨ | ë¡œê·¸ ê¸°ë¡ + Slack ì•Œë¦¼ | 1íšŒ ì¬ì‹œë„ |
| íŒŒì‹± ì‹¤íŒ¨ (ë‚ ì§œ, ë‚˜ì´ ë“±) | ê¸°ë³¸ê°’ ì„¤ì • + ë¡œê·¸ ê¸°ë¡ | ì¬ì‹œë„ ì—†ìŒ |

---

## 7. êµ¬í˜„ ë‹¨ê³„ë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: API ì—°ë™ ì¤€ë¹„ âœ…
- [ ] ê³µê³µë°ì´í„°í¬í„¸ íšŒì›ê°€ì…
- [ ] ë³µì§€ë¡œ API í™œìš©ì‹ ì²­
- [ ] ServiceKey ë°œê¸‰ ë° í™•ì¸
- [ ] API ë¬¸ì„œ ìƒì„¸ í™•ì¸ (ì—”ë“œí¬ì¸íŠ¸, íŒŒë¼ë¯¸í„°, ì‘ë‹µ êµ¬ì¡°)
- [ ] `.env` íŒŒì¼ì— API í‚¤ ì¶”ê°€

### Phase 2: ë¡œì»¬ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ğŸ“
- [ ] `backend/scripts/test_bokjiro_api.py` ì‘ì„±
  - [ ] API í‚¤ ìœ íš¨ì„± ê²€ì¦
  - [ ] ìƒ˜í”Œ ë°ì´í„° 10ê°œ ì¡°íšŒ
  - [ ] ì‘ë‹µ JSON êµ¬ì¡° ì¶œë ¥ ë° í™•ì¸
- [ ] í•„ë“œ ë§¤í•‘ í…ŒìŠ¤íŠ¸
  - [ ] ì¹´í…Œê³ ë¦¬ ë§¤í•‘ ë¡œì§ í…ŒìŠ¤íŠ¸
  - [ ] ë‚˜ì´ íŒŒì‹± ë¡œì§ í…ŒìŠ¤íŠ¸
  - [ ] ì§€ì—­ì½”ë“œ ë§¤í•‘ ë¡œì§ í…ŒìŠ¤íŠ¸

### Phase 3: ë°ì´í„° ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸ êµ¬í˜„ ğŸ”§
- [ ] `backend/scripts/collect_benefits.py` ì‘ì„±
  - [ ] Pagination ì²˜ë¦¬ (ì „ì²´ ë°ì´í„° ìˆœíšŒ)
  - [ ] ë°ì´í„° íŒŒì‹± í•¨ìˆ˜ (`parse_benefit_data()`)
  - [ ] í•„ë“œ ë³€í™˜ í•¨ìˆ˜ (`map_category()`, `parse_age()`, etc.)
  - [ ] ì¤‘ë³µ ì²´í¬ í•¨ìˆ˜ (`check_duplicate()`)
  - [ ] DB ì €ì¥ í•¨ìˆ˜ (`upsert_benefit()`)
  - [ ] ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê¹…
  - [ ] Slack ì•Œë¦¼ í†µí•©
- [ ] ë¡œì»¬ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸
  - [ ] 10ê°œ ìƒ˜í”Œ ë°ì´í„° ìˆ˜ì§‘
  - [ ] ì¤‘ë³µ ì œê±° ë¡œì§ í™•ì¸
  - [ ] DB ì €ì¥ í™•ì¸

### Phase 4: Lambda í•¨ìˆ˜ í†µí•© ğŸš€
- [ ] `backend/functions/data_collector/app.py` ì‘ì„±
  - [ ] ë¡œì»¬ ìŠ¤í¬ë¦½íŠ¸ ë¡œì§ ì´ì‹
  - [ ] Lambda í•¸ë“¤ëŸ¬ í•¨ìˆ˜ ì‘ì„±
  - [ ] í™˜ê²½ ë³€ìˆ˜ ì²˜ë¦¬ (ë¡œì»¬ `.env` vs AWS í™˜ê²½ë³€ìˆ˜)
- [ ] ë¡œì»¬ Lambda í…ŒìŠ¤íŠ¸
  - [ ] `sam local invoke DataCollectorFunction` ì‹¤í–‰
  - [ ] í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸ ì‘ì„± (`test-event.json`)
- [ ] AWS ë°°í¬
  - [ ] `sam build` â†’ `sam deploy`
  - [ ] CloudWatch ë¡œê·¸ í™•ì¸
  - [ ] ì‹¤í–‰ ì„±ê³µ í™•ì¸

### Phase 5: ìŠ¤ì¼€ì¤„ë§ ì„¤ì • â°
- [ ] EventBridge Rule ìƒì„±
  - [ ] ë§¤ì¼ ì˜¤ì „ 11ì‹œ KST ì‹¤í–‰
  - [ ] ë˜ëŠ” ìˆ˜ë™ íŠ¸ë¦¬ê±° (ì´ˆê¸°)
- [ ] ìë™ ì‹¤í–‰ í™•ì¸
- [ ] Slack ì•Œë¦¼ í™•ì¸

---

## 8. íŒŒì¼ êµ¬ì¡°

```
backend/
â”œâ”€â”€ scripts/                           # ë¡œì»¬ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ test_bokjiro_api.py           # API ì—°ê²° í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ collect_benefits.py            # ë°ì´í„° ìˆ˜ì§‘ ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ api_client.py              # API í˜¸ì¶œ ìœ í‹¸
â”‚       â”œâ”€â”€ data_parser.py             # ë°ì´í„° íŒŒì‹± ë¡œì§
â”‚       â””â”€â”€ db_operations.py           # DB CRUD ë¡œì§
â”œâ”€â”€ functions/
â”‚   â””â”€â”€ data_collector/
â”‚       â”œâ”€â”€ app.py                     # Lambda í•¸ë“¤ëŸ¬
â”‚       â””â”€â”€ requirements.txt           # ì˜ì¡´ì„± (requests, supabase)
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ supabase_client.py            # Supabase í´ë¼ì´ì–¸íŠ¸ (ê³µí†µ)
â”‚   â””â”€â”€ slack_notifier.py             # Slack ì•Œë¦¼ (ê³µí†µ)
â””â”€â”€ .env                               # í™˜ê²½ ë³€ìˆ˜ (ë¡œì»¬)
```

---

## 9. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### `.env` íŒŒì¼ ì¶”ê°€

```bash
# Supabase
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# ë³µì§€ë¡œ API
BOKJIRO_API_KEY=your_api_key_here
BOKJIRO_API_URL=http://apis.data.go.kr/B554287/...

# Slack Webhook
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...
```

---

## 10. ì˜ˆìƒ ê²°ê³¼ (MVP ëª©í‘œ)

### ë°ì´í„° ìˆ˜ì§‘ ëª©í‘œ
- **ìµœì†Œ**: 100ê°œ ì´ìƒì˜ ë³µì§€ ì„œë¹„ìŠ¤ ë°ì´í„°
- **ìµœì **: 500~1,000ê°œì˜ ë³µì§€ ì„œë¹„ìŠ¤ ë°ì´í„°
- **ì „ì²´**: ì „êµ­ ë³µì§€ ì„œë¹„ìŠ¤ ì „ì²´ (ì˜ˆìƒ 3,000~5,000ê°œ)

### ì¹´í…Œê³ ë¦¬ ë¶„í¬ ì˜ˆìƒ
| ì¹´í…Œê³ ë¦¬ | ì˜ˆìƒ ê±´ìˆ˜ | ë¹„ìœ¨ |
|---------|----------|------|
| ì˜ë£Œì§€ì› (C01) | 500+ | 30% |
| ìƒí™œë¹„ì§€ì› (C02) | 400+ | 25% |
| ì£¼ê±°ì§€ì› (C03) | 300+ | 15% |
| ë¬¸í™”ì—¬ê°€ (C04) | 200+ | 10% |
| ëŒë´„ì„œë¹„ìŠ¤ (C07) | 300+ | 15% |
| ê¸°íƒ€ (C08) | 300+ | 5% |

### ì„±ëŠ¥ ëª©í‘œ
- API í˜¸ì¶œ íšŸìˆ˜: 30~50íšŒ (100ê°œì”© í˜ì´ì§•)
- ì „ì²´ ì‹¤í–‰ ì‹œê°„: < 5ë¶„
- ì¤‘ë³µ ì œê±°ìœ¨: 5~10% (ì¬ìˆ˜ì§‘ ì‹œ)
- ì—ëŸ¬ìœ¨: < 1%

---

## 11. ì°¸ê³  ìë£Œ

### ê³µì‹ ë¬¸ì„œ
- [ë³µì§€ë¡œ Open API ê°€ì´ë“œ](https://www.bokjiro.go.kr/ssis-tbu/twataa/wlfareInfo/openapi/OpenApiInfoUserGuide.do)
- [ê³µê³µë°ì´í„°í¬í„¸](https://www.data.go.kr/)
- [Supabase Python Client](https://supabase.com/docs/reference/python/introduction)

### ê´€ë ¨ íŒŒì¼
- `docs/TODO.md` - ì „ì²´ ê°œë°œ TODO
- `docs/PROJECT_OVERVIEW.md` - í”„ë¡œì íŠ¸ ê°œìš”
- `supabase/schema.sql` - DB ìŠ¤í‚¤ë§ˆ

---

## 12. ë‹¤ìŒ ë‹¨ê³„ (1.3 ë°ì´í„° ì„ë² ë”© ìƒì„±)

ë°ì´í„° ìˆ˜ì§‘ì´ ì™„ë£Œë˜ë©´ ë‹¤ìŒ ì‘ì—…:

1. **AWS Bedrock Titan Embeddings V2 ì—°ë™**
   - `benefits.content` â†’ Vector ë³€í™˜
   - 1024ì°¨ì› ë²¡í„° ìƒì„±

2. **`benefit_embeddings` í…Œì´ë¸”ì— ì €ì¥**
   - í˜œíƒ IDë³„ë¡œ ì„ë² ë”© ìƒì„±
   - ê¸´ ë‚´ìš©ì€ chunk ë‹¨ìœ„ë¡œ ë¶„í• 

3. **ë²¡í„° ê²€ìƒ‰ í…ŒìŠ¤íŠ¸**
   - í•˜ì´ë¸Œë¦¬ë“œ RAG í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
   - ì§ˆì˜ ì˜ˆì‹œ: "ì„œìš¸ ê°•ë‚¨êµ¬ì— ì‚¬ëŠ” 70ì„¸ ì—¬ì„±ì´ ë°›ì„ ìˆ˜ ìˆëŠ” ì˜ë£Œ ì§€ì›ì€?"

---

## 13. í•µì‹¬ ì§ˆë¬¸ ë‹µë³€ ìš”ì•½

### Q1: ë³µì§€/í˜œíƒ APIëŠ” ë³µì§€ë¡œì™€ ê³µê³µë°ì´í„°í¬í„¸ ë‘ ê°œê°€ ì „ë¶€ì¸ê°€?

**ë‹µë³€**: ì•„ë‹ˆìš”, ë” ìˆìŠµë‹ˆë‹¤!

| ìš°ì„ ìˆœìœ„ | ì œê³µì²˜ | ë¹„ê³  |
|---------|--------|------|
| 1ìˆœìœ„ â­â­â­ | ë³µì§€ë¡œ (bokjiro.go.kr) | MVP ë‹¨ê³„ì—ì„œ ìš°ì„  êµ¬í˜„ |
| 2ìˆœìœ„ â­â­ | ê³µê³µë°ì´í„°í¬í„¸ (data.go.kr) | êµ­ê³ ë³´ì¡°ê¸ˆ ì •ë³´ |
| ì¶”ê°€ â­â­ | ì„œìš¸ì‹œ ì—´ë¦°ë°ì´í„°ê´‘ì¥ | ì„œìš¸ì‹œ ìì²´ ë³µì§€ ì„œë¹„ìŠ¤ |
| ì¶”ê°€ â­â­ | ê²½ê¸°ë„ ê³µê³µë°ì´í„° | ê²½ê¸°ë„ ìì²´ ë³µì§€ ì„œë¹„ìŠ¤ |
| ì°¸ê³  â­ | ê¸°íƒ€ ì§€ìì²´ API | ë¶€ì‚°, ì¸ì²œ ë“± (í™•ì¥ ë‹¨ê³„) |

**ì „ëµ**: 
- âœ… MVP ë‹¨ê³„: **ë³µì§€ë¡œ 1ê°œë§Œ** êµ¬í˜„
- âœ… í™•ì¥ ë‹¨ê³„: ì£¼ìš” ì§€ìì²´ ì¶”ê°€ (ì„œìš¸, ê²½ê¸°, ë¶€ì‚° ë“±)

### Q2: ì²˜ìŒì—ëŠ” ëª‡ ê°œì›”/ë…„ ì „ ë°ì´í„°ë¥¼ ì €ì¥í•˜ë‚˜? (10ë…„ì€ ë¶ˆí•„ìš”í•˜ì§€ ì•Šë‚˜?)

**ë‹µë³€**: **ìµœê·¼ 1~2ë…„ + í˜„ì¬ ìœ íš¨í•œ ë°ì´í„°ë§Œ** âœ…

**ê·¼ê±°**:
- âŒ 10ë…„ ì „ ë°ì´í„°ëŠ” ë¶ˆí•„ìš” (ì œë„ ë³€ê²½, ì¢…ë£Œëœ ì„œë¹„ìŠ¤)
- âœ… 1~2ë…„ ì „ ë°ì´í„°ëŠ” ìœ ìš© (í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì¥ê¸° ë³µì§€ ì„œë¹„ìŠ¤)
- âœ… í˜„ì¬ ìœ íš¨í•œ ë°ì´í„° ìš°ì„  (`application_end_date >= í˜„ì¬ ë‚ ì§œ`)

**êµ¬í˜„**:
```python
# ì´ˆê¸° ìˆ˜ì§‘: 2ë…„ ì „ë¶€í„° ì˜¤ëŠ˜ê¹Œì§€
start_date = (datetime.now() - timedelta(days=365*2)).strftime('%Y%m%d')
params = {'fromDate': start_date, 'toDate': datetime.now().strftime('%Y%m%d')}
```

### Q3: ì´ˆê¸° ì €ì¥ í›„ ë§¤ì¼ ìˆ˜ì§‘ ì‹œ, ìƒˆë¡œìš´ ë°ì´í„°ë§Œ ì–´ë–»ê²Œ ë„£ë‚˜?

**ë‹µë³€**: **3ê°€ì§€ ì¦ë¶„ ìˆ˜ì§‘ ì „ëµ** ì¤‘ í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ ì¶”ì²œ â­

#### ì „ëµ 1: ë§ˆì§€ë§‰ ìˆ˜ì§‘ ì‹œê° ê¸°ë°˜ (Best)
```python
# ë§ˆì§€ë§‰ ì„±ê³µ ì‹œê° ì¡°íšŒ
last_sync = get_last_successful_sync('bokjiro')  # 2026-01-20 11:00:00

# APIì— ë‚ ì§œ í•„í„° ì „ë‹¬
params = {
    'fromDate': last_sync.strftime('%Y%m%d'),
    'toDate': datetime.now().strftime('%Y%m%d')
}
```

#### ì „ëµ 2: ì „ì²´ ì¡°íšŒ + DB ì¤‘ë³µ ì²´í¬ (Fallback)
- APIê°€ ë‚ ì§œ í•„í„° ë¯¸ì§€ì› ì‹œ
- ì „ì²´ ë°ì´í„° ì¡°íšŒ í›„ DBì—ì„œ ì¤‘ë³µ ì²´í¬

#### ì „ëµ 3: í•˜ì´ë¸Œë¦¬ë“œ (ì¶”ì²œ) â­
```python
# 1ì£¼ì¼ ì „ë¶€í„° ì¡°íšŒ (ì•ˆì „ ë§ˆì§„)
start_date = (datetime.now() - timedelta(days=7)).strftime('%Y%m%d')

for item in recent_items:
    # ì¤‘ë³µ ì²´í¬ í›„ UPSERT
    if exists_in_db(item):
        if content_changed(item):
            update_benefit(item)  # UPDATE
        else:
            continue  # SKIP
    else:
        insert_benefit(item)  # INSERT
```

**ë¡œê¹…**:
```python
# api_sync_logs í…Œì´ë¸”ì— ê¸°ë¡
{
    'source_name': 'bokjiro',
    'status': 'SUCCESS',
    'rows_affected': 5,        # ì‹ ê·œ ì‚½ì…
    'duplicates_skipped': 120  # ì¤‘ë³µ ìŠ¤í‚µ
}
```

**Slack ì•Œë¦¼**:
```
âœ… ë³µì§€ë¡œ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ
- ì‹ ê·œ: 5ê±´
- ì—…ë°ì´íŠ¸: 2ê±´
- ì¤‘ë³µ: 120ê±´
- ì‹¤í–‰ ì‹œê°„: 45ì´ˆ
```

---

**ì‘ì„±ì¼**: 2026-01-21  
**ì‘ì„±ì**: AI Assistant  
**ë‹¤ìŒ ì‘ì—…**: API í‚¤ ë°œê¸‰ â†’ ë¡œì»¬ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±


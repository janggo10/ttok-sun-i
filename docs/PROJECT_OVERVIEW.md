# ğŸ‘µ í”„ë¡œì íŠ¸ ë§ˆìŠ¤í„° í”Œëœ: ë˜‘ìˆœì´ (Ttok-sun-i)

## 1. ì„œë¹„ìŠ¤ ì •ì˜ ë° íƒ€ê²Ÿ

- **ì„œë¹„ìŠ¤ëª…**: ë˜‘ìˆœì´ - ì‹œë‹ˆì–´ í˜œíƒ ì•Œë¦¬ë¯¸
- **í•µì‹¬ ê°€ì¹˜**: ë³µì¡í•œ ê³µê³µ í˜œíƒì„ ì‹œë‹ˆì–´ ëˆˆë†’ì´ì—ì„œ í•´ì„í•˜ê³  ë§ì¶¤í˜•ìœ¼ë¡œ í‘¸ì‹œ ì•Œë¦¼ ì œê³µ
- **íƒ€ê²Ÿ ìœ ì €**: 
    - **ì‹œë‹ˆì–´**: 5070 ì•¡í‹°ë¸Œ ì‹œë‹ˆì–´ (ì¹´ì¹´ì˜¤í†¡ ì ‘ê·¼)
    - **ì¼ë°˜/ìë…€ ì„¸ëŒ€**: 1040 ì²­ë…„ ë° ì¤‘ì¥ë…„, ë¶€ëª¨ë‹˜ ë³µì§€ë¥¼ ì±™ê¸°ëŠ” ìë…€ (ì „ìš© ì•± ì ‘ê·¼)
- **í”Œë«í¼**: 
    - **ì¹´ì¹´ì˜¤í†¡ ì±„ë„**: ì‹œë‹ˆì–´ ì¹œí™”ì  ê°„í¸ ì¸í„°í˜ì´ìŠ¤
    - **ëª¨ë°”ì¼ ì•± (ì˜ˆì •)**: ì „ ì—°ë ¹ ëŒ€ìƒ ìƒì„¸ ê²€ìƒ‰ ë° ë§ì¶¤í˜• ëŒ€ì‹œë³´ë“œ

## 2. ê¸°ìˆ  ìŠ¤íƒ (Tech Stack)

- **Frontend**: KakaoTalk Chatbot Interface
- **Backend**: AWS Serverless (Python, Lambda, API Gateway)
- **Database**: Supabase (PostgreSQL + pgvector)
- **AI/LLM**: Gemini Pro / GPT-4o-mini (RAG êµ¬í˜„ ë° ë¬¸ì„œ ìš”ì•½)
- **Infrastructure**: AWS SAM CLI, S3 (ë¬¸ì„œ ì„ì‹œ ì €ì¥)

## 3. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (Supabase SQL)

ì´ ìŠ¤í‚¤ë§ˆë¥¼ Supabase SQL Editorì—ì„œ ì‹¤í–‰í•˜ì—¬ ë¼ˆëŒ€ë¥¼ ë§Œë“­ë‹ˆë‹¤.

```sql
-- í™•ì¥ ì„¤ì¹˜
create extension if not exists vector;

-- ì‚¬ìš©ì ì •ë³´ (ì´ì‚¬ ëŒ€ì‘ ë° ê°œì¸í™”)
create table users (
  id uuid primary key default uuid_generate_v4(),
  kakao_user_id text unique not null,
  region_si_do text,
  region_si_gun_gu text,
  interest_age_groups text[],  -- ['ì¤‘ì¥ë…„', 'ë…¸ë…„'] (ë³µìˆ˜ ì„ íƒ) â­
  created_at timestamp with time zone default now()
);

-- í˜œíƒ ë§ˆìŠ¤í„° (ì •í˜• ë°ì´í„°)
-- ìƒì„¸ ìŠ¤í‚¤ë§ˆ: docs/UNIFIED_SCHEMA_DESIGN.md ì°¸ê³  â­
create table benefits (
  id bigint primary key generated always as identity,
  serv_id varchar(20) unique not null,
  title text not null,
  category text,
  life_nm_array text[],  -- ì—°ë ¹ëŒ€ ['ì²­ë…„', 'ì¤‘ì¥ë…„', 'ë…¸ë…„'] â­
  region_filter text,
  content text,
  original_url text,
  created_at timestamp with time zone default now()
);

-- ë¹„ì •í˜• ë°ì´í„° ë²¡í„° ì €ì¥ì†Œ
create table benefit_embeddings (
  id uuid primary key default uuid_generate_v4(),
  benefit_id bigint references benefits(id) on delete cascade,
  embedding vector(1536),
  content_chunk text
);
```

## 4. ë°ì´í„° ìˆ˜ì§‘ API ì „ëµ

### 4.1 ì§€ìì²´ë³µì§€ì„œë¹„ìŠ¤ API (ë³µì§€ë¡œ)
- **APIëª…**: í•œêµ­ì‚¬íšŒë³´ì¥ì •ë³´ì›_ì§€ìì²´ë³µì§€ì„œë¹„ìŠ¤ëª©ë¡ì¡°íšŒ
- **ì¶œì²˜**: ê³µê³µë°ì´í„°í¬í„¸ (data.go.kr)
- **ì—”ë“œí¬ì¸íŠ¸**: `https://apis.data.go.kr/B554287/LocalGovernmentWelfareInformations/LcgvWelfarelist`

### 4.2 ë°ì´í„° ìˆ˜ì§‘ ì „ëµ (Phase 1 MVP)
```python
# ìˆ˜ì§‘ ì„¤ì •
life_array=None       # ëª¨ë“  ì—°ë ¹ëŒ€ ìˆ˜ì§‘ (ì¤‘ìš”!) â­
age=None              # ë‚˜ì´ í•„í„° ì œê±°
ctpv_nm='ì„œìš¸íŠ¹ë³„ì‹œ'  # ì„œìš¸ë§Œ ìˆ˜ì§‘
```

**ì „ëµ ë°°ê²½:**
- âœ… **ì„œìš¸ ì „ì²´ ì—°ë ¹ëŒ€ ìˆ˜ì§‘**: 357ê°œ ë³µì§€ ì„œë¹„ìŠ¤
- â­ **ëª¨ë“  ì—°ë ¹ëŒ€ ìˆ˜ì§‘ ì´ìœ **:
  1. í–¥í›„ ì„œë¹„ìŠ¤ í™•ì¥ ëŒ€ë¹„ (ì²­ë…„, ì¤‘ì¥ë…„ ë“±)
  2. ì¬ìˆ˜ì§‘ ë¶ˆí•„ìš” (ì´ˆê¸° í•œ ë²ˆë§Œ)
  3. ìŠ¤í† ë¦¬ì§€ ë¹„ìš© < ê°œë°œ/ìš´ì˜ ë¹„ìš©
  4. ì—°ë ¹ëŒ€ë³„ í˜œíƒ í†µê³„ íŒŒì•… ê°€ëŠ¥
- ğŸ¯ **ì—°ë ¹ëŒ€ ê¸°ë°˜ í•„í„°ë§**: ì‚¬ìš©ìê°€ ì„ íƒí•œ ì—°ë ¹ëŒ€(`life_nm_array`)ë¡œ DBì—ì„œ ì§ì ‘ í•„í„°ë§
  - ì˜¨ë³´ë”©: "ì–´ë–¤ ì—°ë ¹ëŒ€ì˜ í˜œíƒì„ ë°›ê³  ì‹¶ìœ¼ì‹ ê°€ìš”? (ë³µìˆ˜ ì„ íƒ)"
  - ì˜ˆ: ['ì¤‘ì¥ë…„', 'ë…¸ë…„'] ì„ íƒ â†’ `life_nm_array && ARRAY['ì¤‘ì¥ë…„', 'ë…¸ë…„']` ì¿¼ë¦¬
- ğŸ“ˆ **í™•ì¥ ê°€ëŠ¥**: í–¥í›„ ê²½ê¸°ë„(1193ê°œ), ì „êµ­(4550ê°œ) í™•ì¥ ìš©ì´

**ë°ì´í„° ê·œëª¨ (ì§€ìì²´ API):**
| í•„í„° ì¡°ê±´ | ë°ì´í„° ê±´ìˆ˜ | ë¹„ê³  |
|----------|------------|------|
| ì„œìš¸ ì‹œë‹ˆì–´(65ì„¸+) | 1ê°œ | âŒ í•„í„° ë„ˆë¬´ ê°•í•¨ |
| ì„œìš¸ ì „ì²´ ì—°ë ¹ | 357ê°œ | âœ… MVP ì „ëµ |
| ì „êµ­ ì „ì²´ | 4550ê°œ | Phase 2 |

### 4.3 í–¥í›„ ì¶”ê°€ API ì—°ë™ ê³„íš
- ì¤‘ì•™ë¶€ì²˜ë³µì§€ì„œë¹„ìŠ¤ API (ë³´ë¥˜ - íŒŒë¼ë¯¸í„° ì´ìŠˆ)
- ì„œìš¸ì‹œ ì—´ë¦°ë°ì´í„°ê´‘ì¥ (í•„ìš”ì‹œ)
- ê²½ê¸°ë„ ë°ì´í„°ë“œë¦¼ (í™•ì¥ ì‹œ)

## 5. í•µì‹¬ ë¡œì§ ë° ê¸°ëŠ¥ ëª…ì„¸

### í•˜ì´ë¸Œë¦¬ë“œ RAG â­
ìœ ì €ì˜ **ì§€ì—­/ì—°ë ¹ëŒ€**ë¡œ SQL í•„í„°ë§ì„ ë¨¼ì € ìˆ˜í–‰í•œ ë’¤, í•´ë‹¹ ë²”ìœ„ ë‚´ì—ì„œë§Œ ë²¡í„° ê²€ìƒ‰ì„ ì‹¤í–‰í•˜ì—¬ í• ë£¨ì‹œë„¤ì´ì…˜(í™˜ê°) ë°©ì§€

**ê²€ìƒ‰ ì¿¼ë¦¬ ì˜ˆì‹œ:**
```sql
SELECT * FROM benefits
WHERE (
    -- ì‚¬ìš©ì ì§€ì—­ (ì§€ìì²´ ë³µì§€)
    (ctpv_nm = 'ì„œìš¸íŠ¹ë³„ì‹œ' AND sgg_nm = 'ì¢…ë¡œêµ¬')
    OR
    -- ì „êµ­ ë‹¨ìœ„ (ì¤‘ì•™ë¶€ì²˜ ë³µì§€)
    (ctpv_nm IS NULL AND source_api = 'NATIONAL')
)
-- ì‚¬ìš©ìê°€ ì„ íƒí•œ ì—°ë ¹ëŒ€
AND life_nm_array && ARRAY['ì¤‘ì¥ë…„', 'ë…¸ë…„']
```

### ë°ì´í„° íŒŒì´í”„ë¼ì¸
1. ê³µê³µë°ì´í„° API ìˆ˜ì§‘ (ì§€ìì²´ë³µì§€ì„œë¹„ìŠ¤ API)
2. ì§€ìì²´ ê³µê³ (PDF, HWP, Excel) ë‹¤ìš´ë¡œë“œ ë° í…ìŠ¤íŠ¸ ì¶”ì¶œ (Phase 2)
3. LLMì„ í™œìš©í•œ í•µì‹¬ 3ìš”ì†Œ(ëŒ€ìƒ, ê¸ˆì•¡, ë°©ë²•) ìš”ì•½ ë° ë²¡í„°í™”

### ì‚¬ìš©ì ê´€ë¦¬ ë° ì˜¨ë³´ë”© â­
- **ì˜¨ë³´ë”© í”„ë¡œì„¸ìŠ¤**:
  1. ê±°ì£¼ì§€ ì„ íƒ (ì‹œ/ë„, ì‹œ/êµ°/êµ¬)
  2. **ê´€ì‹¬ ì—°ë ¹ëŒ€ ì„ íƒ** (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)
     - ì˜ˆ: ['ì¤‘ì¥ë…„', 'ë…¸ë…„'] ì„ íƒ
     - APIì˜ `lifeNmArray` ê°’ê³¼ ì§ì ‘ ë§¤ì¹­
- **ë°ì´í„° ë™ê¸°í™”**: 6ê°œì›” ë‹¨ìœ„ ê±°ì£¼ì§€/ê´€ì‹¬ì‚¬ í™•ì¸ ì•Œë¦¼

## 6. ìˆ˜ìµ ë° ë§ˆì¼€íŒ… ì „ëµ

### ìˆ˜ìµí™”
- **ì´ˆê¸°**: ì¿ íŒ¡/ì•Œë¦¬ ì–´í•„ë¦¬ì—ì´íŠ¸ API ì—°ë™
- **ì„±ì¥ê¸°**: ê°€ì…ì í™•ë³´ í›„ ê³ ë‹¨ê°€ CPA(ë³‘ì›, ë³´í—˜ ìƒë‹´ ì—°ê²°) ë„ì…

### ë§ˆì¼€íŒ…
- ìˆí¼ ìë™ ìƒì„± íŒŒì´í”„ë¼ì¸(ì„œìš¸ì‹œ 25ê°œ êµ¬ íƒ€ê²Ÿ)
- ìë…€ ì„¸ëŒ€ ëŒ€ìƒ 'íš¨ë„ ë§ˆì¼€íŒ…' ì „ê°œ

---

## 7. AI ì½”ë”© ìœ ì˜ì‚¬í•­

> **ì¤‘ìš”**: AIê°€ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ ë°˜ë“œì‹œ ì¤€ìˆ˜í•´ì•¼ í•  ì›ì¹™

### âš ï¸ í•„ìˆ˜ ì›ì¹™

1. **ëª…í™•í•˜ê²Œ ì´í•´í•˜ì§€ ëª»í–ˆìœ¼ë©´ ì½”ë”©í•˜ê¸° ì „ì— ì§ˆë¬¸ì„ ë¨¼ì €**
   - ìš”êµ¬ì‚¬í•­ì´ ì• ë§¤í•˜ê±°ë‚˜ ë¶ˆëª…í™•í•œ ê²½ìš° ì¦‰ì‹œ ì§ˆë¬¸
   - ì¶”ì¸¡ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ ë§ ê²ƒ
   - ì—¬ëŸ¬ í•´ì„ì´ ê°€ëŠ¥í•œ ê²½ìš° ëª¨ë“  ì˜µì…˜ì„ ì œì‹œí•˜ê³  í™•ì¸ ìš”ì²­

2. **Fallback í•˜ì§€ ë§ê³  ì—ëŸ¬ ì²˜ë¦¬**
   - ì—ëŸ¬ ë°œìƒ ì‹œ ì¡°ìš©íˆ fallback í•˜ì§€ ë§ ê²ƒ
   - ëª…ì‹œì ì¸ ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹… í•„ìˆ˜
   - Slack ì•Œë¦¼ì„ í†µí•œ ì—ëŸ¬ ëª¨ë‹ˆí„°ë§
   - ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ

3. **ë¡œì»¬ í…ŒìŠ¤íŠ¸ ìš°ì„  ê°œë°œ**
   - AWS ë°°í¬ ë° í…ŒìŠ¤íŠ¸ëŠ” ì‹œê°„ì´ ë§ì´ ì†Œìš”ë¨
   - ê°€ëŠ¥í•œ ëª¨ë“  ê¸°ëŠ¥ì„ **ë¡œì»¬ì—ì„œ ë¨¼ì € êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸**
   - SupabaseëŠ” Dockerë¡œ ë¡œì»¬ ì‹¤í–‰ (`supabase start`)
   - Lambda í•¨ìˆ˜ëŠ” `sam local invoke`ë¡œ ë¡œì»¬ í…ŒìŠ¤íŠ¸
   - AWS ë°°í¬ëŠ” ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ìµœì¢… ê²€ì¦ ë‹¨ê³„ì—ì„œë§Œ
   - ê°œë°œ ì‚¬ì´í´: **ì½”ë“œ ì‘ì„± â†’ ë¡œì»¬ í…ŒìŠ¤íŠ¸ â†’ ë””ë²„ê¹… â†’ AWS ë°°í¬**

4. **í´ë¦° ì½”ë“œ: íŒŒì¼ ë¶„ë¦¬**
   - íŒŒì¼ì˜ ë‚´ìš©ì´ ë§ì•„ì§€ë©´ **ì—¬ëŸ¬ íŒŒì¼ë¡œ ë¶„ë¦¬**
   - ë‹¨ì¼ ì±…ì„ ì›ì¹™ (Single Responsibility Principle) ì¤€ìˆ˜
   - ê° íŒŒì¼ì€ í•˜ë‚˜ì˜ ëª…í™•í•œ ëª©ì ì„ ê°€ì ¸ì•¼ í•¨
   - ì˜ˆ: `app.py`ê°€ 500ì¤„ ì´ìƒì´ë©´ â†’ `handlers/`, `utils/`, `models/` ë“±ìœ¼ë¡œ ë¶„ë¦¬
   - ëª¨ë“ˆí™”ë¥¼ í†µí•œ ì¬ì‚¬ìš©ì„± ë° í…ŒìŠ¤íŠ¸ ìš©ì´ì„± í–¥ìƒ

### ì˜ˆì‹œ

**âŒ ë‚˜ìœ ì˜ˆ (Fallback)**
```python
def get_user_region(user_id):
    try:
        region = supabase.table('users').select('region_code').eq('id', user_id).execute()
        return region.data[0]['region_code']
    except:
        return 'ALL'  # ì¡°ìš©íˆ fallback - ë‚˜ì¨!
```

**âœ… ì¢‹ì€ ì˜ˆ (ëª…ì‹œì  ì—ëŸ¬ ì²˜ë¦¬)**
```python
def get_user_region(user_id):
    try:
        result = supabase.table('users').select('region_code').eq('id', user_id).execute()
        if not result.data:
            raise ValueError(f'User not found: {user_id}')
        return result.data[0]['region_code']
    except Exception as e:
        notify_error('get_user_region ì‹¤íŒ¨', {
            'ì‚¬ìš©ì ID': user_id,
            'ì—ëŸ¬': str(e)
        })
        raise  # ì—ëŸ¬ë¥¼ ìƒìœ„ë¡œ ì „íŒŒ
```

